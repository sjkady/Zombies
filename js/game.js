(function(){for(var d=0,a,c,e,b=["ms","moz","webkit","o"],r=0;r<b.length&&!window.requestAnimationFrame;++r)window.requestAnimationFrame=window[b[r]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[r]+"CancelAnimationFrame"]||window[b[r]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,r){a=Date.now();c=Math.max(0,16-(a-d));e=window.setTimeout(function(){b(a+c)},c);d=a+c;return e});window.cancelAnimationFrame||(window.cancelAnimationFrame=
function(a){clearTimeout(a)})})();window.Game={};
(function(){function d(a,c,e,b){this.left=a||0;this.top=c||0;this.width=e||0;this.height=b||0;this.right=this.left+this.width;this.bottom=this.top+this.height}d.prototype.set=function(a,c,e,b){this.left=a;this.top=c;this.width=e||this.width;this.height=b||this.height;this.right=this.left+this.width;this.bottom=this.top+this.height};d.prototype.within=function(a){return a.left<=this.left&&a.right>=this.right&&a.top<=this.top&&a.bottom>=this.bottom};d.prototype.overlaps=function(a){return this.left<
a.right&&a.left<this.right&&this.top<a.bottom&&a.top<this.bottom};Game.Rectangle=d})();
(function(){function d(c,e,b,d,f,l){this.xView=c||0;this.yView=e||0;this.yDeadZone=this.xDeadZone=0;this.wView=b;this.hView=d;this.axis=a.BOTH;this.followed=null;this.viewportRect=new Game.Rectangle(this.xView,this.yView,this.wView,this.hView);this.worldRect=new Game.Rectangle(0,0,f,l)}var a={NONE:"none",HORIZONTAL:"horizontal",VERTICAL:"vertical",BOTH:"both"};d.prototype.follow=function(a,e,b){this.followed=a;this.xDeadZone=e;this.yDeadZone=b};d.prototype.update=function(){if(null!==this.followed){if(this.axis==
a.HORIZONTAL||this.axis==a.BOTH)this.followed.x-this.xView+this.xDeadZone>this.wView?this.xView=this.followed.x-(this.wView-this.xDeadZone):this.followed.x-this.xDeadZone<this.xView&&(this.xView=this.followed.x-this.xDeadZone);if(this.axis==a.VERTICAL||this.axis==a.BOTH)this.followed.y-this.yView+this.yDeadZone>this.hView?this.yView=this.followed.y-(this.hView-this.yDeadZone):this.followed.y-this.yDeadZone<this.yView&&(this.yView=this.followed.y-this.yDeadZone)}this.viewportRect.set(this.xView,this.yView);
this.viewportRect.within(this.worldRect)||(this.viewportRect.left<this.worldRect.left&&(this.xView=this.worldRect.left),this.viewportRect.top<this.worldRect.top&&(this.yView=this.worldRect.top),this.viewportRect.right>this.worldRect.right&&(this.xView=this.worldRect.right-this.wView),this.viewportRect.bottom>this.worldRect.bottom&&(this.yView=this.worldRect.bottom-this.hView))};Game.Camera=d})();
(function(){function d(a,c){this.x=a;this.y=c;this.prex=a;this.prey=c;this.health=3;this.roundopacity=this.hurtopacity=this.points=this.kills=0;this.move=!0;this.gun=0;this.speed=300;this.height=this.width=40}d.prototype.update=function(a,c,e,b){Game.controls.one&&(this.gun=0);Game.controls.two&&(this.gun=1);Game.controls.three&&(this.gun=2);Game.controls.four&&(this.gun=3);Game.controls.five&&(this.gun=4);0<=this.health&&!0===this.move&&(Game.controls.left&&(this.prex=Game.controls.up||Game.controls.down?
this.prex-this.speed/Math.sqrt(2)*a:this.prex-this.speed*a),Game.controls.right&&(this.prex=Game.controls.up||Game.controls.down?this.prex+this.speed/Math.sqrt(2)*a:this.prex+this.speed*a),Game.controls.up&&(this.prey=Game.controls.right||Game.controls.left?this.prey-this.speed/Math.sqrt(2)*a:this.prey-this.speed*a),Game.controls.down&&(this.prey=Game.controls.right||Game.controls.left?this.prey+this.speed/Math.sqrt(2)*a:this.prey+this.speed*a));0>this.prex-this.width/2&&(this.prex=this.width/2);
0>this.prey-this.height/2&&(this.prey=this.height/2);this.prex+this.width/2>c&&(this.prex=c-this.width/2);this.prey+this.height/2>e&&(this.prey=e-this.height/2);for(a=b.length-1;0<=a;a--)Math.abs(this.prex-b[a].x)<=b[a].width/2+this.width/2&&Math.abs(this.prey-b[a].y)<=b[a].height/2+this.height/2&&(this.move=!1);!0===this.move?(this.x=this.prex,this.y=this.prey):(this.prex=this.x,this.prey=this.y,this.move=!0)};d.prototype.draw=function(a,c,e){a.save();a.fillStyle="#E5C298";a.fillRect(this.x-this.width/
2-c,this.y-this.height/2-e,this.width,this.height);a.restore()};Game.Player=d})();
(function(){function d(a,c,e){this.x=a;this.y=c;this.prex=a;this.prey=c;this.mag=this.dy=this.dx=0;this.health=e;this.attackable=!0;this.hit=!1;this.movey=this.movex=!0;this.cooldown=Math.floor(3E3*Math.random()+1E3);this.speed=Math.floor(200*Math.random()+50);this.height=this.width=30}d.prototype.update=function(a,c,e,b,d){this.dx=c.x-this.x;this.dy=c.y-this.y;this.mag=Math.sqrt(this.dx*this.dx+this.dy*this.dy);this.prex+=this.dx/this.mag*this.speed*a;for(var f=b.length-1;0<=f;f--)f!=d&&Math.abs(this.prex-
b[f].x)<this.width/2+b[f].width/2&&Math.abs(this.prey-b[f].y)<this.height/2+b[f].height/2&&(this.movex=!1,this.prex-=this.dx/this.mag*this.speed*a);for(f=e.length-1;0<=f;f--)Math.abs(this.prex-e[f].x)<=e[f].width/2+this.width/2&&Math.abs(this.prey-e[f].y)<=e[f].height/2+this.height/2&&(this.movex=!1,this.prex-=this.dx/this.mag*this.speed*a);this.prey+=this.dy/this.mag*this.speed*a;for(f=b.length-1;0<=f;f--)f!=d&&Math.abs(this.prex-b[f].x)<this.width/2+b[f].width/2&&Math.abs(this.prey-b[f].y)<this.height/
2+b[f].height/2&&(this.movex=!1,this.prey-=this.dy/this.mag*this.speed*a);for(b=e.length-1;0<=b;b--)Math.abs(this.prex-e[b].x)<=e[b].width/2+this.width/2&&Math.abs(this.prey-e[b].y)<=e[b].height/2+this.height/2&&(this.movey=!1,this.prey-=this.dy/this.mag*this.speed*a);!0===this.movex?this.x=this.prex:(this.prex=this.x,this.movex=!0);!0===this.movey?this.y=this.prey:(this.prey=this.y,this.movey=!0);Math.abs(this.x-c.x)<this.width/2+c.width/2&&Math.abs(this.y-c.y)<this.height/2+c.height/2&&!0===this.attackable&&
(this.attackable=!1,setTimeout(function(a){console.log("attack over");a.attackable=!0},this.cooldown,this),--c.health,2===c.health?heart1.style.display="None":1===c.health?heart2.style.display="None":0===c.health&&(heart3.style.display="None"),c.hurtopacity=.9,0<=c.health&&(setTimeout(function(){c.hurtopacity-=.1},100),setTimeout(function(){c.hurtopacity-=.2},200),setTimeout(function(){c.hurtopacity-=.2},300),setTimeout(function(){c.hurtopacity-=.2},400),setTimeout(function(){c.hurtopacity-=.2},500)))};
d.prototype.draw=function(a,c,e){a.save();a.fillStyle=!0===this.hit?"#8A0707":!0===this.attackable?"#A2AD59":"#8E936D";a.fillRect(this.x-this.width/2-c,this.y-this.height/2-e,this.width,this.height);a.restore()};Game.Zombie=d})();
(function(){function d(a,c,e,b,d,f,l){this.x=a;this.y=c;this.dx=e-(a-d);this.dy=b-(c-f);this.mag=Math.sqrt(this.dx*this.dx+this.dy*this.dy);this.speed=l.speed;this.width=l.width;this.height=l.height;this.damage=l.damage;this.splash=l.splash;this.piercing=l.piercing;this.shots=l.shots}d.prototype.update=function(a){this.x+=this.dx/this.mag*this.speed*a;this.y+=this.dy/this.mag*this.speed*a};d.prototype.draw=function(a,c,e){a.save();a.fillStyle="#000000";a.fillRect(this.x-this.width/2-c,this.y-this.height/
2-e,this.width,this.height);a.restore()};Game.Bullet=d})();(function(){function d(a,c,e,b){this.x=a;this.y=c;this.width=e;this.height=b}d.prototype.draw=function(a,c,e){a.save();a.fillStyle="#584D3D";a.fillRect(this.x-this.width/2-c,this.y-this.height/2-e,this.width,this.height);a.restore()};Game.Obstacle=d})();
(function(){Game.Gun=function(d,a,c,e,b,r,f,l,q,w,g,m){this.name=d;this.damage=a;this.ammo=c;this.clipsize=this.clip=e;this.shots=b;this.splash=r;this.piercing=f;this.cooldown=this.cooltime=l;this.reloadtime=this.reload=q;this.speed=w;this.width=g;this.height=m}})();(function(){Game.Spawnpoint=function(d,a){this.x=d;this.y=a}})();(function(){Game.GunBuy=function(d,a){this.x=d;this.y=a;this.height=this.width=100}})();
(function(){function d(a,c){this.width=a;this.height=c;this.image=null}d.prototype.generate=function(){var a=document.createElement("canvas").getContext("2d");a.canvas.width=this.width;a.canvas.height=this.height;var c=Math.floor(this.width/44)+1,e=Math.floor(this.height/44)+1,b="#CEDFD9";a.save();a.fillStyle="#CEDFD9";for(var d=0,f=0;f<c;d+=44,f++){a.beginPath();for(var l=0,q=0;q<e;l+=44,q++)a.rect(d,l,40,40);b="#CEDFD9"==b?"#EBFCFB":"#CEDFD9";a.fillStyle=b;a.fill();a.closePath()}a.restore();this.image=
new Image;this.image.src=a.canvas.toDataURL("image/png")};d.prototype.draw=function(a,c,e){var b,d;b=a.canvas.width;d=a.canvas.height;this.image.width-c<b&&(b=this.image.width-c);this.image.height-e<d&&(d=this.image.height-e);a.drawImage(this.image,c,e,b,d,0,0,b,d)};Game.Map=d})();
(function(){var d,a,c,e=document.getElementById("gameCanvas");e.addEventListener("mousedown",function(b){d=!0;void 0!==b.clientX&&void 0!==b.clientY&&(a=b.clientX,c=b.clientY)},!1);e.addEventListener("mousemove",function(b){d&&void 0!==b.clientX&&void 0!==b.clientY&&(a=b.clientX,c=b.clientY)},!1);e.addEventListener("mouseup",function(a){d=!1},!1);var b=e.getContext("2d");b.canvas.width=1080<.8*window.innerWidth?1080:.8*window.innerWidth;b.canvas.height=824<.8*window.innerHeight?824:.7*window.innerHeight;
var r=0,f=0,l=f-r,q=new Game.Map(1760,880);q.generate();for(var w=[new Game.Spawnpoint(-100,-100),new Game.Spawnpoint(880,-100),new Game.Spawnpoint(1860,-100),new Game.Spawnpoint(-100,440),new Game.Spawnpoint(-100,980),new Game.Spawnpoint(880,980),new Game.Spawnpoint(1860,980),new Game.Spawnpoint(1860,440)],g=new Game.Player(880,440),m=[],p=[new Game.Obstacle(Math.floor(1760*Math.random()),Math.floor(880*Math.random()),Math.floor(400*Math.random()+50),Math.floor(400*Math.random()+50)),new Game.Obstacle(Math.floor(1760*
Math.random()),Math.floor(880*Math.random()),Math.floor(400*Math.random()+50),Math.floor(400*Math.random()+50)),new Game.Obstacle(Math.floor(1760*Math.random()),Math.floor(880*Math.random()),Math.floor(400*Math.random()+50),Math.floor(400*Math.random()+50)),new Game.Obstacle(Math.floor(1760*Math.random()),Math.floor(880*Math.random()),Math.floor(400*Math.random()+50),Math.floor(400*Math.random()+50))],u=p.length-1;0<=u;u--)p[u].x+p[u].width/2>=g.x-g.width&&p[u].x-p[u].width/2<=g.x+g.width&&p[u].y+
p[u].height/2>=g.y-g.height&&p[u].y-p[u].height/2<=g.y+g.height&&p.splice(u,1);var h=[],x=[new Game.Gun("Base Pistol",1,64,8,1,0,0,1,2,700,4,4),new Game.Gun("Semi Pistol",1,120,15,3,0,0,1,2,700,4,4),new Game.Gun("Machine Gun",1,300,30,1,0,0,.2,5,700,4,4),new Game.Gun("Pea Shooter",.5,200,20,1,0,0,.1,3,700,2,2),new Game.Gun("Rifle",5,50,5,1,0,0,3,5,700,6,6)],t=new Game.Camera(0,0,e.width,e.height,1760,880),y=2500,z=10,A=1;t.follow(g,e.width/2,e.height/2);var B=function(){if(-1!=v){var a=Math.floor(Math.random()*
w.length);0<z&&m.length<=z&&(m.push(new Game.Zombie(w[a].x,w[a].y,A)),--z);0>=z&&(clearInterval(spawner),A+=1,round.style.color="#808080",900<=y&&(y-=200),round.innerHTML="Round:"+A,setTimeout(function(){g.roundopacity=.9;0<=g.health&&(setTimeout(function(){g.roundopacity-=.1},100),setTimeout(function(){g.roundopacity-=.2},200),setTimeout(function(){g.roundopacity-=.2},300),setTimeout(function(){g.roundopacity-=.2},400),setTimeout(function(){g.roundopacity-=.2},500));z=7*A;round.style.color="#282e25";
spawner=setInterval(B,y)},4E3))}},E=function(a){m[a].hit=!0;setTimeout(function(){"undefined"!=typeof m[a]&&(m[a].hit=!1)},100)},C=function(b){g.update(b,1760,880,p);for(var f=m.length-1;0<=f;f--)m[f].update(b,g,p,m,f);if(d){var f=g.x,k=g.y,n=a-e.offsetLeft,l=c-e.offsetTop,r=t.xView,u=t.yView,q=x[g.gun];if(0<q.clip&&0>=q.cooldown)for(var v=q.shots-1;0<=v;v--){var w=setTimeout;h.push(new Game.Bullet(f,k,n,l,r,u,q));w(void 0,30*v);q.cooldown=q.cooltime;--q.clip}}f=x[g.gun];for(k=h.length-1;0<=k;k--){h[k].update(b);
for(n=m.length-1;0<=n;n--)"undefined"!=typeof h[k]&&Math.abs(m[n].x-h[k].x)<m[n].width/2+h[k].width/2&&Math.abs(m[n].y-h[k].y)<m[n].height/2+h[k].height/2&&(m[n].health-=f.damage,h.splice(k,1),0>=m[n].health?(m.splice(n,1),g.kills+=1,g.points+=50,kills.innerHTML="Kills:"+g.kills,points.innerHTML="Points:"+g.points):(g.points+=10,points.innerHTML="Points:"+g.points,E(n)));"undefined"!=typeof h[k]&&(h[k].x>Map.width||0>h[k].x?h.splice(k,1):(h[k].y>Map.height||0>h[k].y)&&h.splice(k,1));for(n=p.length-
1;0<=n;n--)"undefined"!=typeof h[k]&&(Math.abs(h[k].x-p[n].x)<p[n].width/2+h[k].width/2&&Math.abs(h[k].y-p[n].y)<=p[n].height/2+h[k].height/2?h.splice(k,1):(h[k].y>Map.height||0>h[k].y)&&h.splice(k,1))}0<=f.cooldown&&(f.cooldown-=b);0>=f.clip&&(f.reload-=b);0>=f.reload&&0<f.ammo&&(f.ammo-=f.clipsize-f.clip,f.clip=Math.min(f.clipsize,f.ammo),f.reload=f.reloadtime);t.update()},v=-1,D=function(a){f=a;l=(f-r)/1E3;r=f;.2<l?C(1E-4):C(l);b.clearRect(0,0,e.width,e.height);q.draw(b,t.xView,t.yView);for(a=
m.length-1;0<=a;a--)m[a].draw(b,t.xView,t.yView);for(a=h.length-1;0<=a;a--)h[a].draw(b,t.xView,t.yView);for(a=p.length-1;0<=a;a--)p[a].draw(b,t.xView,t.yView);0<g.hurtopacity&&(b.save(),b.fillStyle="#8A0707",b.globalAlpha=g.hurtopacity,b.fillRect(0,0,e.width,e.height),b.restore());0<g.roundopacity&&(b.save(),b.fillStyle="#197319",b.globalAlpha=g.roundopacity,b.fillRect(0,0,e.width,e.height),b.restore());g.draw(b,t.xView,t.yView);b.font="20px Special Elite";b.fillStyle=0>=x[g.gun].clip?"#808080":"#2e2528";
b.fillText(x[g.gun].name+" "+x[g.gun].clip+"/"+x[g.gun].ammo,30,e.height-20);v=requestAnimationFrame(D)};Game.play=function(){-1==v&&(spawner=setInterval(B,y),v=requestAnimationFrame(D),console.log("play"))};Game.togglePause=function(){-1==v?Game.play():(cancelAnimationFrame(v),v=-1,clearInterval(spawner),console.log("paused"))}})();Game.controls={left:!1,up:!1,right:!1,down:!1,reload:!1,action:!1,one:!1,two:!1,three:!1,four:!1,five:!1};
window.addEventListener("keydown",function(d){switch(d.keyCode){case 65:Game.controls.left=!0;break;case 87:Game.controls.up=!0;break;case 68:Game.controls.right=!0;break;case 83:Game.controls.down=!0;break;case 69:Game.controls.action=!0;break;case 81:Game.controls.reload=!0;break;case 49:Game.controls.one=!0;break;case 50:Game.controls.two=!0;break;case 51:Game.controls.three=!0;break;case 52:Game.controls.four=!0;break;case 53:Game.controls.five=!0}},!1);
window.addEventListener("keyup",function(d){switch(d.keyCode){case 65:Game.controls.left=!1;break;case 87:Game.controls.up=!1;break;case 68:Game.controls.right=!1;break;case 83:Game.controls.down=!1;break;case 80:Game.togglePause();break;case 69:Game.controls.action=!1;break;case 81:Game.controls.reload=!1;break;case 49:Game.controls.one=!1;break;case 50:Game.controls.two=!1;break;case 51:Game.controls.three=!1;break;case 52:Game.controls.four=!1;break;case 53:Game.controls.five=!1}},!1);
window.onload=function(){var d=document.getElementById("loading");d.parentNode.removeChild(d);document.getElementById("round");document.getElementById("heart1");document.getElementById("heart2");document.getElementById("heart3");document.getElementById("kills");document.getElementById("points");Game.play()};
